<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Query Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    #results {
      margin-top: 30px;
    }
    .query-section {
      display: none;
    }
    table {
      margin-top: 15px;
    }
  </style>
</head>
<body class="bg-light">

  <div class="container py-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h1 class="h3 mb-0">Admin Query Dashboard</h1>
        <small class="text-muted">Welcome, <span id="adminEmail">admin@example.com</span></small>
      </div>
      <div>
        <a href="/chat-page.html" class="btn btn-outline-primary me-2">Back to Chat</a>
        <button class="btn btn-danger" onclick="logout()">Logout</button>
      </div>
    </div>

    <!-- Query Menu -->
    <div id="query-menu" class="mb-4">
      <div class="btn-group flex-wrap" role="group">
        <button class="btn btn-primary" onclick="showQuery('query1')">Messages in Chat Room</button>
        <button class="btn btn-primary" onclick="showQuery('query2')">Active Chat Rooms</button>
        <button class="btn btn-primary" onclick="showQuery('query3')">Active Users</button>
        <button class="btn btn-primary" onclick="showQuery('query4')">Keyword Search</button>
        <button class="btn btn-primary" onclick="showQuery('query5')">Least Active Users by Role</button>
      </div>
    </div>

    <!-- Query Sections -->
    <div id="query-content">

      <!-- Query 1 -->
      <div id="query1" class="query-section card p-4 mb-4">
        <h4>Messages in Chat Room</h4>
        <div class="mb-3">
          <label for="chatRoomSelect" class="form-label">Select Chat Room:</label>
          <select id="chatRoomSelect" class="form-select">
            <option value="">Loading rooms...</option>
          </select>
        </div>
        <button class="btn btn-success" onclick="runQuery1()">Run Query</button>
      </div>

      <!-- Query 2 -->
      <div id="query2" class="query-section card p-4 mb-4">
        <h4>Most Active Chat Rooms</h4>
        <button class="btn btn-success" onclick="runQuery2()">Run Query</button>
      </div>

      <!-- Query 3 -->
      <div id="query3" class="query-section card p-4 mb-4">
        <h4>Most Active Users</h4>
        <button class="btn btn-success" onclick="runQuery3()">Run Query</button>
      </div>

      <!-- Query 4 -->
      <div id="query4" class="query-section card p-4 mb-4">
        <h4>Search Messages by Keyword</h4>
        <div class="mb-3">
          <label for="keywordInput" class="form-label">Keyword:</label>
          <input type="text" id="keywordInput" class="form-control" placeholder="e.g., update, error">
        </div>
        <button class="btn btn-success" onclick="runQuery4()">Run Query</button>
      </div>

      <!-- Query 5 -->
      <div id="query5" class="query-section card p-4 mb-4">
        <h4>Least Active Users by Role</h4>
        <div class="mb-3">
          <label for="roleSelect" class="form-label">Select Role:</label>
          <select id="roleSelect" class="form-select">
            <option value="">Loading roles...</option>
          </select>
        </div>
        <button class="btn btn-success" onclick="runQuery5()">Run Query</button>
      </div>
    </div>

    <!-- Results -->
    <div id="results" class="card p-4">
      <h4>Query Results</h4>
      <div id="resultsContainer" class="table-responsive"></div>
    </div>
  </div>

  <!-- Script -->
  <script src="query-page.js"></script>
  <script>
    // üîê Validate login session
    const email = sessionStorage.getItem("chat_email");
    if (!email) {
      alert("You must log in first.");
      window.location.href = "/login.html";
    } else {
      document.getElementById("adminEmail").textContent = email;
    }

    function logout() {
      sessionStorage.removeItem("chat_email");
      window.location.href = "/login.html";
    }
  </script>
</body>
</html>